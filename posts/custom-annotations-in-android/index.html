<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Custom Annotations in Android" /><meta name="author" content="Igor Brishkoski" /><meta property="og:locale" content="en_US" /><meta name="description" content="Annotations in Java 1.5" /><meta property="og:description" content="Annotations in Java 1.5" /><link rel="canonical" href="https://igor-brishkoski.com/posts/custom-annotations-in-android/" /><meta property="og:url" content="https://igor-brishkoski.com/posts/custom-annotations-in-android/" /><meta property="og:site_name" content="Igor Brishkoski" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-04-17T02:10:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Custom Annotations in Android" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Igor Brishkoski" /><meta name="google-site-verification" content="jVTJ1XTMFbvn58GziUp5qiNP9n93dWZut6A-ChZEhSc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Igor Brishkoski"},"dateModified":"2017-04-17T02:10:00-04:00","datePublished":"2017-04-17T02:10:00-04:00","description":"Annotations in Java 1.5","headline":"Custom Annotations in Android","mainEntityOfPage":{"@type":"WebPage","@id":"https://igor-brishkoski.com/posts/custom-annotations-in-android/"},"url":"https://igor-brishkoski.com/posts/custom-annotations-in-android/"}</script><title>Custom Annotations in Android | Igor Brishkoski</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4FLJ3B5KQ2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4FLJ3B5KQ2'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/igor.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Igor Brishkoski</a></div><div class="site-subtitle font-italic">A space to post and blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/igor-brishkoski" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['igor.brishkoski','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/igor-brishkoski/" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Custom Annotations in Android</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Custom Annotations in Android</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Igor Brishkoski </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 17, 2017, 2:10 AM -0400" prep="on" > Apr 17, 2017 <i class="unloaded">2017-04-17T02:10:00-04:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2796 words">15 min</span></div></div><div class="post-content"><h2 id="annotations-in-java-15">Annotations in Java 1.5</h2><p>Before java annotations, program metadata was available through java comments or by javadoc, but annotations offer more than that.</p><p>Java Annotations are introduced in Java 1.5, and now they are heavily used in Java frameworks including Android. Java Annotations are metadata about the program embedded in the program itself, but annotations have no direct effect on the operation of the code they annotate (i.e., it does not affect the execution of the program). They can provide compile-time instructions to the compiler that can be further used by software build tools for generating code, XML files, etc. They can be associated with classes, methods, fields, parameters and even other annotations.</p><p>Java 1.5 offers 3 built-in annotations.</p><p><code class="language-plaintext highlighter-rouge">@Override</code> which is used to tell the compiler that we’re overriding a method, it makes the code readable and maintainable, it also helps with avoiding issues when the signature of the method that we’re overriding is changed.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyParentClass</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">justaMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Parent class method"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyChildClass</span> <span class="kd">extends</span> <span class="nc">MyParentClass</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">justaMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Child class method"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@Deprecated</code> annotation marks the annotated element (class, field, method) as deprecated and indicates that it should not be used. The compiler then issues a warning when that element is used. Good practice is to document the deprecated element with javadoc on the reason of why it was deprecated.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cm">/**
 * @deprecated
 * reason for why it was deprecated
 */</span>
<span class="nd">@Deprecated</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">anyMethodHere</span><span class="o">(){</span>
    <span class="c1">// Do something</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@SuppressWarnings</code> is used to silence the compiler whenever it gives us those annoying deprecated or other warnings.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"deprecation"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">myMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">myObject</span><span class="o">.</span><span class="na">deprecatedMethod</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Java 1.7 and 1.8 bring a few more built-in annotations.</p><h2 id="android-support-annotations-library">Android Support Annotations Library</h2><p>BIn addition to the already built-in java annotations, Android, through the android support library provides additional annotations. If you’re interested in more, visit the <a href="https://developer.android.com/studio/write/annotations.html">library page</a>.</p><h2 id="creating-a-custom-annotation">Creating a Custom Annotation</h2><p>We learned about the annotations that are built in java, and we saw that we can include 3rd party annotations in our project, now let’s see how we can build our own custom annotation.</p><p>Java annotations are just interfaces prefixed with <code class="language-plaintext highlighter-rouge">@</code> sign. Easy enough, let’s create our first custom annotation. We’re going to call it <code class="language-plaintext highlighter-rouge">MethodInfo</code> and it will provide some basic info for the method the developers are building.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Inherited</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MethodInfo</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">author</span><span class="o">()</span> <span class="k">default</span> <span class="s">"Igor Brishkoski"</span><span class="o">;</span>
    <span class="kt">int</span> <span class="nf">revision</span><span class="o">()</span> <span class="k">default</span> <span class="mi">1</span><span class="o">;</span>
    <span class="nc">String</span> <span class="nf">comments</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>That’s pretty much it. Now let’s go over the code line by line and see what’s going on.</p><p>As we can see, we have several annotations on our interface. <code class="language-plaintext highlighter-rouge">@Target</code> Specifies the elements on which this annotation can be used. In this case, we have <code class="language-plaintext highlighter-rouge">ElementType.METHOD</code> since we’re going to be annotating only methods. Other elements that can be annotated are:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">PACKAGE</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">ANNOTATION_TYPE</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">CONSTRUCTOR</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">LOCAL_VARIABLE</span>
<span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@Retention</code> annotation tells the compiler when will it be needed.</p><p><code class="language-plaintext highlighter-rouge">RetentionPolicy.RUNTIME</code> The annotation should be available at runtime, for inspection via java reflection. <code class="language-plaintext highlighter-rouge">RetentionPolicy.CLASS</code> The annotation would be in the .class file, but it would not be available at runtime. <code class="language-plaintext highlighter-rouge">RetentionPolicy.SOURCE</code> The annotation would be available in the source code of the program, it would neither be in the .class file nor be available at the runtime.</p><p><code class="language-plaintext highlighter-rouge">@Documented</code> annotation indicates that elements using this annotation will be documented by JavaDoc. When we’re creating the docs, the annotation will be included in the docs.</p><p><code class="language-plaintext highlighter-rouge">@Inherited</code> annotation tells the compiler that all subclasses of the annotated class will inherit the annotation.</p><p>Great! We now have our own custom annotation, let’s see it in action.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@MethodInfo</span><span class="o">(</span><span class="n">author</span> <span class="o">=</span> <span class="s">"John Snow"</span><span class="o">,</span> <span class="n">revision</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">"Hey!"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">awesomeMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"awesomeMethod"</span><span class="o">);</span>
    <span class="nc">MethodInfo</span> <span class="n">methodInfo</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MethodInfo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"MethodInfo"</span><span class="o">,</span> <span class="n">methodInfo</span><span class="o">.</span><span class="na">author</span><span class="o">());</span>
    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"MethodInfo"</span><span class="o">,</span> <span class="n">methodInfo</span><span class="o">.</span><span class="na">revision</span><span class="o">());</span>
    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"MethodInfo"</span><span class="o">,</span> <span class="n">methodInfo</span><span class="o">.</span><span class="na">comments</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>We have annotated the <code class="language-plaintext highlighter-rouge">awesomeMethod()</code> with our custom annotation, and since we set the retention policy to be at runtime, we can access the values of the annotation. This is great, but the true power of annotations comes from compile time code generation.</p><h2 id="annotation-processor">Annotation Processor</h2><p>Let’s see how we can create our own processor and include that processor in our app.</p><p>You can check code on GitHub <a href="https://github.com/igor-brishkoski/AwesomeApp/">https://github.com/igor-brishkoski/AwesomeApp/</a></p><h3 id="our-problem">Our Problem</h3><p>Let’s say we’re developing a lot of android apps. We’re using logcat to debug our apps and to see what’s going on during development, so we want to make logging models in our projects easier and more standardized. Our new app AwesomeApp has a model called <code class="language-plaintext highlighter-rouge">User</code> which has several fields like <code class="language-plaintext highlighter-rouge">firstName</code>, <code class="language-plaintext highlighter-rouge">lastName</code> and <code class="language-plaintext highlighter-rouge">city</code> and if we want to log the values of the class to <code class="language-plaintext highlighter-rouge">Logcat</code>, our code would look something like this.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//AwesomeApp</span>
<span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">city</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">...</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="nc">User</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Gandalf"</span><span class="o">,</span> <span class="s">"The White"</span><span class="o">,</span> <span class="s">"Maia"</span><span class="o">);</span>

        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"User"</span><span class="o">,</span> <span class="s">"firstName = "</span><span class="o">+</span><span class="n">g</span><span class="o">.</span><span class="na">firstName</span><span class="o">+</span> <span class="s">" lastname = "</span><span class="o">+</span><span class="n">g</span><span class="o">.</span><span class="na">lastName</span><span class="o">+</span><span class="s">" city = "</span><span class="o">+</span><span class="n">g</span><span class="o">.</span><span class="na">city</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>And by adding more fields in our model, the log statement will only get bigger.</p><p>For our solution, we’re going to annotate our model class with our custom annotation and create a logger, using our annotation processor, based on the fields in our model.</p><h3 id="our-custom-annotation">Our Custom Annotation</h3><p>For our custom annotation, we’re going to create a separate module in our project and add the module as a dependency to our app. Go to <code class="language-plaintext highlighter-rouge">File -&gt; New -&gt; New Module...</code> in Android Studio. Select <code class="language-plaintext highlighter-rouge">Java Library</code> and name the module <code class="language-plaintext highlighter-rouge">annotation</code></p><p>You’ll notice a new folder in your project structure with its own <code class="language-plaintext highlighter-rouge">build.gradle</code> file. You will also notice that our new module has been added to our settings.gradle file, but in order for that module to be available in our app, we need to include it as a dependency in our app <code class="language-plaintext highlighter-rouge">build.gradle</code> file.</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//our app build.gradle file</span>
<span class="n">dependencies</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="n">provided</span> <span class="nf">project</span><span class="o">(</span><span class="s1">':annotation'</span><span class="o">)</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Great! Let’s create our custom annotation <code class="language-plaintext highlighter-rouge">AwesomeLogger</code> in the new module that we just created. We will use it to annotate our models for which we want to create loggers for.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// annotation module</span>
<span class="kn">package</span> <span class="nn">com.example.annotation</span><span class="o">;</span>

<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span> <span class="c1">//class level</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">SOURCE</span><span class="o">)</span> <span class="c1">//we only need it at compile time</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">AwesomeLogger</span> <span class="o">{}</span>
</pre></table></code></div></div><p>We’re setting the target to be <code class="language-plaintext highlighter-rouge">ElementType.TYPE</code> which represents a class or interface program element, and we’re setting the retention policy to be <code class="language-plaintext highlighter-rouge">RententionPolicy.SOURCE</code> meaning we will only need the annotations during compile time.</p><p>Now we can annotate the User model in our app.</p><h3 id="our-annotation-processor">Our Annotation Processor</h3><p>What is Annotation Processor?</p><p>Annotation processor is a tool built in javac for scanning and processing annotations at compile time. This means that we can register our custom annotation <code class="language-plaintext highlighter-rouge">AwesomeLogger</code> to be picked up by the processor, and the processor can generate <code class="language-plaintext highlighter-rouge">.java</code> files for us containing the code necessary for our logger helper class.</p><p>For our Annotation Processor, we’re going to create a separate module in our project and add the module as a dependency to our app.</p><p>Go to <code class="language-plaintext highlighter-rouge">File -&gt; New -&gt; New Module...</code> in Android Studio. Select <code class="language-plaintext highlighter-rouge">Java Library</code> and name the module <code class="language-plaintext highlighter-rouge">processor</code></p><p>Create a class <code class="language-plaintext highlighter-rouge">AwesomeLoggerProcessor</code> and have that class extend the <code class="language-plaintext highlighter-rouge">AbstractProcessor</code> class. Every processor has to extend from the <code class="language-plaintext highlighter-rouge">AbstractProcessor</code></p><p>Let’s look at some of the APIs we’re going to use.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AwesomeLoggerProcessor</span> <span class="kd">extends</span> <span class="nc">AbstractProcessor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">ProcessingEnvironment</span> <span class="n">env</span><span class="o">){</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">TypeElement</span><span class="o">&gt;</span> <span class="n">annoations</span><span class="o">,</span> <span class="nc">RoundEnvironment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getSupportedAnnotationTypes</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">SourceVersion</span> <span class="nf">getSupportedSourceVersion</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">init</code> — The processor has to have an empty constructor. The init method is provided to us to help us instantiate everything that we need to get the party started. We’re being passed an instance of <code class="language-plaintext highlighter-rouge">ProcessingEnvironment</code> that provides a lot of useful utility classes that we’re going to use such as the <code class="language-plaintext highlighter-rouge">Filer</code> for generating files, the <code class="language-plaintext highlighter-rouge">Messager</code> for helping us with error handling and more.<li><code class="language-plaintext highlighter-rouge">process</code> — Is where the magic happens. Here we’re going to process all annotations that we care about, like the <code class="language-plaintext highlighter-rouge">AwesomeLogger</code><li><code class="language-plaintext highlighter-rouge">getSupportedAnnotationsTypes</code> — Is where we specify the annotations that this processor will be handling in the process method, in our case that’s the <code class="language-plaintext highlighter-rouge">AwesomeLogger</code> class.<li><code class="language-plaintext highlighter-rouge">getSupportedSourceVersion</code> — Is where we specify the Java version. Most of the time we go with the latest supported.</ul><h3 id="registering-our-processor">Registering Our Processor</h3><p>The cool thing to know about the processor is that it runs in a separate <strong>JVM</strong> instance. This means that the <code class="language-plaintext highlighter-rouge">javac</code> starts a whole new process just for our processor, but in order for our processor to be detected by the <code class="language-plaintext highlighter-rouge">javac</code> we need to register it with the <code class="language-plaintext highlighter-rouge">ServiceLoader</code>.</p><p>To register our processor, we’re going to use Google’s <code class="language-plaintext highlighter-rouge">AutoService</code> annotation. Whaaa!?!?! Mind… Blown. We can use annotations in our annotation processor? Yes, we sure can. We should treat our annotation processor as we treat our apps, that means that we should architect it properly, we can include dependencies to help us out with development, we should test it, etc…</p><p>Let’s include the dependency in our processor’s module build.gradle file.</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//processor module</span>
<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="s1">'libs'</span><span class="o">,</span> <span class="nl">include:</span> <span class="o">[</span><span class="s1">'*.jar'</span><span class="o">])</span>
    <span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s1">':annotation'</span><span class="o">)</span>

    <span class="n">compile</span> <span class="s1">'com.google.auto.service:auto-service:1.0-rc2'</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Now we can annotate our processor with <code class="language-plaintext highlighter-rouge">AutoService</code> and that will do all the heavy lifting for us. Here we have a little preview of our processor so far.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nd">@AutoService</span><span class="o">(</span><span class="nc">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// 1</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AwesomeLoggerProcessor</span> <span class="kd">extends</span> <span class="nc">AbstractProcessor</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">KEY_PARAM_NAME</span> <span class="o">=</span> <span class="s">"args"</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">METHOD_LOG</span> <span class="o">=</span> <span class="s">"log"</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CLASS_SUFFIX</span> <span class="o">=</span> <span class="s">"_Log"</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Messager</span> <span class="n">messager</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Filer</span> <span class="n">filer</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">ProcessingEnvironment</span> <span class="n">processingEnvironment</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">processingEnvironment</span><span class="o">);</span>
      <span class="n">messager</span> <span class="o">=</span> <span class="n">processingEnvironment</span><span class="o">.</span><span class="na">getMessager</span><span class="o">();</span> <span class="c1">// 2</span>
      <span class="n">filer</span> <span class="o">=</span> <span class="n">processingEnvironment</span><span class="o">.</span><span class="na">getFiler</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">TypeElement</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="nc">RoundEnvironment</span> <span class="n">roundEnvironment</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">SourceVersion</span> <span class="nf">getSupportedSourceVersion</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">SourceVersion</span><span class="o">.</span><span class="na">latestSupported</span><span class="o">();</span> <span class="c1">// 3</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getSupportedAnnotationTypes</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">annotations</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
      <span class="n">annotations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AwesomeLogger</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getCanonicalName</span><span class="o">());</span> <span class="c1">// 4</span>

      <span class="k">return</span> <span class="n">annotations</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ol><li>We registered it with the <code class="language-plaintext highlighter-rouge">AutoService</code> annotation to be picked up by <code class="language-plaintext highlighter-rouge">javac</code>.<li>We got our util classes in the init method.<li>We’re going to support the latest java version.<li>And we only care about the <code class="language-plaintext highlighter-rouge">AwesomeLogger</code> in this processor.</ol><h3 id="processing-our-annotations">Processing our Annotations</h3><p>We can finally start to process our annotated elements.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">TypeElement</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="nc">RoundEnvironment</span> <span class="n">roundEnvironment</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//get all elements annotated with AwesomeLogger</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Element</span><span class="o">&gt;</span> <span class="n">annotatedElements</span> <span class="o">=</span> <span class="n">roundEnvironment</span><span class="o">.</span><span class="na">getElementsAnnotatedWith</span><span class="o">(</span><span class="nc">AwesomeLogger</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">Element</span> <span class="n">type</span> <span class="o">:</span> <span class="n">annotatedElements</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>On line 4, with the help of the <code class="language-plaintext highlighter-rouge">RoundEnvironment</code> instance provided to us, we’re getting a collection of elements annotated with our <code class="language-plaintext highlighter-rouge">AwesomeLogger</code> annotation. The problem is we’re getting <strong>ALL</strong> elements not just the ones that we set the target for with <code class="language-plaintext highlighter-rouge">@Target(ElementType.TYPE)</code>, this means if a developer who is using our custom annotations, annotates a class field <code class="language-plaintext highlighter-rouge">ElementType.FIELD</code> for example, we will get that element in our collection. This is not a problem with modern IDEs because they will immediately start complaining about it. However, we don’t know if everyone using our annotation will be using a modern IDE, it’s always better to be safe than sorry.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example</span><span class="o">;</span>		<span class="c1">// PackageElement</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>		<span class="c1">// TypeElement</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span><span class="c1">// VariableElement</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span> <span class="c1">// VariableElement</span>

	<span class="kd">public</span> <span class="nf">User</span> <span class="o">()</span> <span class="o">{}</span> 	<span class="c1">// ExecuteableElement</span>
<span class="o">}</span>
</pre></table></code></div></div><p>We can use <code class="language-plaintext highlighter-rouge">guava</code> to help us with the filtering of the elements that we care about.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">TypeElement</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="nc">RoundEnvironment</span> <span class="n">roundEnvironment</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//get all elements annotated with AwesomeLogger</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Element</span><span class="o">&gt;</span> <span class="n">annotatedElements</span> <span class="o">=</span> <span class="n">roundEnvironment</span><span class="o">.</span><span class="na">getElementsAnnotatedWith</span><span class="o">(</span><span class="nc">AwesomeLogger</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">//filter out elements we don't need</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TypeElement</span><span class="o">&gt;</span> <span class="n">types</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ImmutableList</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">TypeElement</span><span class="o">&gt;()</span>
            <span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">ElementFilter</span><span class="o">.</span><span class="na">typesIn</span><span class="o">(</span><span class="n">annotatedElements</span><span class="o">))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">TypeElement</span> <span class="n">type</span> <span class="o">:</span> <span class="n">types</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>That’s it, we got the elements that we want right? Wrong! Remember when we said that <code class="language-plaintext highlighter-rouge">**TYPE**</code> element can be either a class or an interface. What if it’s abstract or private? Luckily, we can get information for the element, and we can use that information to decide whether that class is valid for us. For that, we’re going to create a helper method called <code class="language-plaintext highlighter-rouge">isValidClass</code> to check if the element meets our criteria.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isValidClass</span><span class="o">(</span><span class="nc">TypeElement</span> <span class="n">type</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getKind</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">ElementKind</span><span class="o">.</span><span class="na">CLASS</span><span class="o">){</span>
        <span class="n">messager</span><span class="o">.</span><span class="na">printMessage</span><span class="o">(</span><span class="nc">Diagnostic</span><span class="o">.</span><span class="na">Kind</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span><span class="n">type</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()+</span><span class="s">" only classes can be annotated with AwesomeLogger"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)){</span>
        <span class="n">messager</span><span class="o">.</span><span class="na">printMessage</span><span class="o">(</span><span class="nc">Diagnostic</span><span class="o">.</span><span class="na">Kind</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span><span class="n">type</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()+</span><span class="s">" only public classes can be annotated with AwesomeLogger"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">ABSTRACT</span><span class="o">)){</span>
        <span class="n">messager</span><span class="o">.</span><span class="na">printMessage</span><span class="o">(</span><span class="nc">Diagnostic</span><span class="o">.</span><span class="na">Kind</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span><span class="n">type</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()+</span><span class="s">" only non abstract classes can be annotated with AwesomeLogger"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="error-handling">Error Handling</h3><p>Since the processor is running in its own <code class="language-plaintext highlighter-rouge">JVM</code>, throwing an exception will cause the JVM to crash and deliver a confusing, useless error message to the developer. For that reason, we got an instance of the <code class="language-plaintext highlighter-rouge">Messager</code> in the <code class="language-plaintext highlighter-rouge">init</code> method. As you can see above in our helper method, we use the <code class="language-plaintext highlighter-rouge">messager</code> to deliver readable error messages to the developer who is misusing our annotation without crashing the <code class="language-plaintext highlighter-rouge">JVM</code>. In modern IDEs you can also jump right to the place where the error was caused, pretty handy.</p><h3 id="code-generation">Code Generation</h3><p>Now we can finally start generating code, the reason we created our custom annotation and the annotation processor. We can use the instance of the <code class="language-plaintext highlighter-rouge">Filer</code> that we got in our <code class="language-plaintext highlighter-rouge">init</code> method, however when it comes to source java code generation <code class="language-plaintext highlighter-rouge">JavaPoet</code> by <code class="language-plaintext highlighter-rouge">Square</code> (shocking right? who would have guessed that we’ll be using a library made by Square in our project. These guys have done so much for the Android development community that I’m tempted to offer my firstborn to them as a thank-you. OK, back to our code) is the default standard.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeSourceFile</span><span class="o">(</span><span class="nc">TypeElement</span> <span class="n">originatingType</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//get Log class from android.util package</span>
    <span class="c1">//This will make sure the Log class is properly imported into our class</span>
    <span class="nc">ClassName</span> <span class="n">logClassName</span> <span class="o">=</span> <span class="nc">ClassName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"android.util"</span><span class="o">,</span> <span class="s">"Log"</span><span class="o">);</span>

    <span class="c1">//get the current annotated class name</span>
    <span class="nc">TypeVariableName</span> <span class="n">typeVariableName</span> <span class="o">=</span> <span class="nc">TypeVariableName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">originatingType</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>

    <span class="c1">//create static void method named log</span>
    <span class="nc">MethodSpec</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">MethodSpec</span><span class="o">.</span><span class="na">methodBuilder</span><span class="o">(</span><span class="no">METHOD_LOG</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addModifiers</span><span class="o">(</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">,</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">STATIC</span><span class="o">)</span>
            <span class="o">.</span><span class="na">returns</span><span class="o">(</span><span class="kt">void</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="c1">//Parameter variable based on the annotated class</span>
            <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">typeVariableName</span><span class="o">,</span> <span class="no">KEY_PARAM_NAME</span><span class="o">)</span>
            <span class="c1">//add a Lod.d("ClassName", String.format(class fields));</span>
            <span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">"$T.d($S, $L)"</span><span class="o">,</span> <span class="n">logClassName</span><span class="o">,</span> <span class="n">originatingType</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">generateFormater</span><span class="o">(</span><span class="n">originatingType</span><span class="o">))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">//create a class to wrap our method</span>
    <span class="c1">//the class name will be the annotated class name + _Log</span>
    <span class="nc">TypeSpec</span> <span class="n">loggerClass</span> <span class="o">=</span> <span class="nc">TypeSpec</span><span class="o">.</span><span class="na">classBuilder</span><span class="o">(</span><span class="n">originatingType</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="no">CLASS_SUFFIX</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addModifiers</span><span class="o">(</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">,</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">FINAL</span><span class="o">)</span>
            <span class="c1">//add the log statetemnt from above</span>
            <span class="o">.</span><span class="na">addMethod</span><span class="o">(</span><span class="n">log</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="c1">//create the file</span>
    <span class="nc">JavaFile</span> <span class="n">javaFile</span> <span class="o">=</span> <span class="nc">JavaFile</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">originatingType</span><span class="o">.</span><span class="na">getEnclosingElement</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">loggerClass</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">javaFile</span><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="n">filer</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="using-the-annotation">Using The Annotation</h3><p>We’re finally ready to use the annotation in our app to help us generate the logging method for our <code class="language-plaintext highlighter-rouge">User</code> class. Let’s rebuild our project so that the code can be generated. Now we can open our generated class <code class="language-plaintext highlighter-rouge">User_Log</code> and see what’s inside.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">User_Log</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="nc">User</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"User"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"firstName - %s lastName - %s city - %s "</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">firstName</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">lastName</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">city</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>We have a static method called <code class="language-plaintext highlighter-rouge">log(User user)</code> that accepts an instance of our <code class="language-plaintext highlighter-rouge">User</code> model and uses Android’s <code class="language-plaintext highlighter-rouge">Log</code> class to output the contents of the model into the logcat.</p><p>In our <code class="language-plaintext highlighter-rouge">MainActivity</code> we can call our generated class method <code class="language-plaintext highlighter-rouge">User_Log.log(g)</code> and watch our beautiful logs in logcat.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="nc">User</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Gandalf"</span><span class="o">,</span> <span class="s">"The White"</span><span class="o">,</span> <span class="s">"Maia"</span><span class="o">);</span>

        <span class="n">User_Log</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">g</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>And that’s pretty much it. Of course, this is a really basic example just to get you started, but we are all aware of the power that annotations bring to the table. Take a look at any of the popular libraries that we use like Butterknife, Dagger, AutoValue and a bunch of others.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/android/'>Android</a>, <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a> <a href="/tags/annotations/" class="post-tag no-text-decoration" >Annotations</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Custom Annotations in Android - Igor Brishkoski&url=https://igor-brishkoski.com/posts/custom-annotations-in-android/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Custom Annotations in Android - Igor Brishkoski&u=https://igor-brishkoski.com/posts/custom-annotations-in-android/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Custom Annotations in Android - Igor Brishkoski&url=https://igor-brishkoski.com/posts/custom-annotations-in-android/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/annotations/">Annotations</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/igor-brishkoski">Igor Brishkoski</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/annotations/">Annotations</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://igor-brishkoski.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
